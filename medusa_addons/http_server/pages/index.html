<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<title>Medusa Homepage</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<!-- <meta http-equiv="refresh" content="4"></meta> -->
<style type="text/css">
.fancy_button {
    -moz-box-shadow:inset 0px 1px 0px 0px #ffffff;
    -webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;
    box-shadow:inset 0px 1px 0px 0px #ffffff;
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ededed), color-stop(1, #dfdfdf) );
    background:-moz-linear-gradient( center top, #ededed 5%, #dfdfdf 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ededed', endColorstr='#dfdfdf');
    background-color:#ededed;
    -moz-border-radius:6px;
    -webkit-border-radius:6px;
    border-radius:6px;
    border:1px solid #dcdcdc;
    display:inline-block;
    color:#0000ff;
    font-family:arial;
    font-size:15px;
    font-weight:bold;
    width:99%;
    text-align: center;
    vertical-align: middle;
    text-decoration:none;
    text-shadow:1px 1px 0px #ffffff;
}.fancy_button:hover {
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #dfdfdf), color-stop(1, #ededed) );
    background:-moz-linear-gradient( center top, #dfdfdf 5%, #ededed 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#dfdfdf', endColorstr='#ededed');
    background-color:#dfdfdf;
}.fancy_button:active {
    position:relative;
    top:1px;
}
p {
    margin: 0;
    padding: 0;
}
#logoDiv {
	position: absolute;
	visibility:visible;
	z-index:5;
	top: 0%;
	right: 0%;
    font-family: Arial, Helvetica, sans-serif;
  	cursor: hand;
  	border-radius: 5px;
  	background-color: #FFFFFF;
	border: 1px solid black;
}

#dsor_logo { background-image: url('logos/dsor_logo.jpg'); }
.dsor_logo { width: 42px;  }
#isr_logo { background-image: url('logos/isr_logo.png'); }
.isr_logo { width: 34px; }
#ist_logo { background-image: url('logos/ist_logo.png'); }
.ist_logo { width: 39px;  }

.logos {
  border-style: solid;
  border-width: 0px;
  padding-top:0;
  background-size: 100% 100%;
  height: 50px;
  text-align: right;
}
/* This imageless css button was generated by CSSButtonGenerator.com */
</style>
    <script>
        var varstoaks=["Safety_Feature", "bat_monit/data", "ThrusterR/Status", "ThrusterL/Status", "gps/data", "imu/data", "Pressure", "leaks/upper", "leaks/lower"];
        function topics_list(){
        	this.topics={};
        	this.addTopic = function(obj_topic){
        		this.topics[obj_topic.name]=obj_topic;
        	}
        }

        function topic(name){
        	this.name=name;
        	this.subtopics = {};
        	this.addSubTopic = function(name,fcn){
        		this.subtopics[name]=fcn;
        	}
        }

        var topics_list = new topics_list();
        var bat = new topic("bat_monit_data");
        bat.addSubTopic('min_cell',"pmin_cell");
        bat.addSubTopic('max_cell',"pmax_cell");
        bat.addSubTopic('current',"pact_curr");
        topics_list.addTopic(bat);

        var imu = new topic("imu_data");
        imu.addSubTopic('Yaw',"pheading");
        imu.addSubTopic('Gz',"pheading_rate");
        topics_list.addTopic(imu);

        var inp = new topic("Pressure");
        inp.addSubTopic('Inside_Pressure',"pinside_pressure");
        inp.addSubTopic('Outside_Pressure',"poutside_pressure");
        topics_list.addTopic(inp);

        var gps = new topic("gps_data");
        gps.addSubTopic('satellites',"psats");
        gps.addSubTopic('latitude',"plat");
        gps.addSubTopic('longitude',"plon");

        topics_list.addTopic(gps);
        var thl = new topic("ThrusterL_Status");
        thl.addSubTopic('Speed',"plm_speed");
        thl.addSubTopic('Current',"plm_curr");
        thl.addSubTopic('Temperature',"plm_temp");
        thl.addSubTopic('Errors',"plm_errors");
        topics_list.addTopic(thl);

        var thr = new topic("ThrusterR_Status");
        thr.addSubTopic('Speed',"prm_speed");
        thr.addSubTopic('Current',"prm_curr");
        thr.addSubTopic('Temperature',"prm_temp");
        thr.addSubTopic('Errors',"prm_errors");
        topics_list.addTopic(thr);

        function clearFields(){
			for(var topic in topics_list.topics){
				for(var subtopic in topics_list.topics[topic].subtopics){
					document.getElementById(topics_list.topics[topic].subtopics[subtopic]).innerHTML = "NA";
				}
			}
        }

        function checkFields(topic, subtopic, text){
        	if(topics_list.topics[topic]  && topics_list.topics[topic].subtopics[subtopic])
        		document.getElementById(topics_list.topics[topic].subtopics[subtopic]).innerHTML = parseFloat(text).toFixed(2)+'';
        }

        function readXML(xmlhttp) {
            //console.log("readXML");
            if(xmlhttp.readyState == 4 && xmlhttp.status==200){
            	clearFields();
                xmlDoc=xmlhttp.responseXML;
                if (xmlDoc){
                    if(xmlDoc.getElementsByTagName("ROSMessage").length!=0){
                        var rosmsg = xmlDoc.getElementsByTagName("ROSMessage");
                        var rosn   = rosmsg.length;
                        var seq_num = 0;
                        for(var i=0;i<rosn;i++){
                        	name_nodeValue = rosmsg[i].attributes.getNamedItem("name").value;

                        	var var_elements = rosmsg[i].getElementsByTagName("KEY");
			                for(var j=0;j<var_elements.length;j++){
			                	var subtopic = "";
			                	var topicvalue = "";
			                	if(var_elements[j].textContent){
			                		subtopic = var_elements[j].textContent;
			                		topicvalue = rosmsg[i].getElementsByTagName("DOUBLE")[j].textContent;
			                	}else{ // IE
			                		subtopic = var_elements[j].text;
			                		topicvalue = rosmsg[i].getElementsByTagName("DOUBLE")[j].text;
			                	}

			                	checkFields(name_nodeValue, subtopic, topicvalue);
			                }
                        }
                    }
                }
            }
            xmlhttp.abort();
        }
        function askVars(){
        	createHTTPreq();
            if(xmlhttp){
            	//xmlhttp.abort();
                xmlhttp.open("GET","/VAR%20" +varstoaks.join("%20"),true);
            	xmlhttp.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT");
                requestTimer = setTimeout(function() {
                	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) readXML(xmlhttp);
                    xmlhttp.abort();
                }, 800);
                xmlhttp.send();
            }
        }
        function init(){
            setInterval("askVars();",1000);
        }

        var requestTimer ;
        var xmlhttp;

        function getXMLHttpRequest()
		{
		    if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
		        return new window.XMLHttpRequest;
		    } else {// code for IE6, IE5
		        try {
		            return new ActiveXObject("MSXML2.XMLHTTP.3.0");
		        }
		        catch(ex) {
		            return null;
		        }
		    }
		}

		function createHTTPreq(){
			xmlhttp = getXMLHttpRequest();

	        if (xmlhttp){
        		xmlhttp.onreadystatechange = function() {
	                if (xmlhttp.readyState != 4)
	                    return;

	                clearTimeout(requestTimer);
	                if (xmlhttp.status != 200){
	                    xmlhttp.abort();
	                    return;
	                }
	                readXML(xmlhttp);
	        	};
	        }
		}
/*        //Http Requester
        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        }else{// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (xmlhttp){
        	xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState != 4)
                    return;

                clearTimeout(requestTimer);
                if (xmlhttp.status != 200){
                    xmlhttp.abort();
                    return;
                }
                readXML(xmlhttp);
        	};
        }*/
    </script>
</head>
<body onload="init();">
	  <div id="logoDiv">
	    <table id="table_header" border="0" cellspacing="0" cellpadding="0" style="width: 100%">
	    	<tr>
	        <td class="dsor_logo"><div class="logos buttons_header" id="dsor_logo" title="DSOR Logo" ></div></td>
	        <td class="isr_logo"><div class="logos buttons_header" id="isr_logo" title="ISR Logo" > </div></td>
	        <td class="ist_logo"><div class="logos buttons_header" id="ist_logo" title="IST Logo" ></div></td>
	        </tr>
	    </table>
	  </div>
	<center>
	<h1>Medusa Homepage</h1>
	<font color=red><p id="safety"></p></font>
	<table frame=box border="1" cellpadding="3" cellspacing="0">
		<tr>
			<th colspan="4">Thrusters</th>
			<th colspan="2">GPS</th>
			<th colspan="2">IMU</th>
			<th colspan="2">Batteries</th>
			<th colspan="2">Pressure</th>
		</tr>
		<tr>
			<td colspan="2">Left:</td>
			<td colspan="2">Right:</td>
			<td colspan="2">Status:</td>
			<td colspan="2">Status:</td>
			<td>Min Cell</td><td><p id="pmin_cell">NA</p></td>
			<td>Inside:</td><td><p id="pinside_pressure">NA</p></font></td>
		</tr>
		<tr>
			<td>Current</td><td><p id="plm_curr">NA</p></td>
			<td>Current</td><td><p id="prm_curr">NA</p></td>
			<td>Lat</td><td><p id="plat">NA</p></td>
			<td>Heading</td><td><p id="pheading">NA</p></td>
			<td>Max Cell</td><td><p id="pmax_cell">NA</p></td>
			<td>Outside:</td><td><p id="poutside_pressure">NA</p></font></td>
		</tr>
		<tr>
			<td>Speed</td><td><p id="plm_speed">NA</p></td>
			<td>Speed</td><td><p id="prm_speed">NA</p></td>
			<td>Lon</td><td><p id="plon">NA</p></td>
			<td>Heading Rate</td><td><p id="pheading_rate">NA</p></td>
			<td>Actual Current</td><td><p id="pact_curr">NA</p></td>
			<td colspan="2" rowspan="2"></td>
		</tr>
		<tr>
			<td>Temperature</td><td><p id="plm_temp">NA</p></td>
			<td>Temperature</td><td><p id="prm_temp">NA</p></td>
			<td>Sats</td><td><p id="psats">NA</p></td>
			<td colspan="2"></td>
			<td><a class='fancy_button' href="./RSET bat_monit/equalize std_msgs/Bool true" >EqOn</a></td>
			<td><a class='fancy_button' href="./RSET bat_monit/equalize std_msgs/Bool false" >EqOff</a></td>
		</tr>
		<tr>
			<td>Faults</td><td><font color=red><p id="plm_errors"></p></font></td>
			<td>Faults</td><td><font color=red><p id="prm_errors"></p></font></td>
			<td colspan="8"></td>
		</tr>
		<tr>
			<td colspan="2"><a class='fancy_button' href="./RSET Thruster_Wash std_msgs/Bool true" >Wash Thrusters</a></td>
			<td colspan="2"></td><td colspan="8"></td>
		</tr>
		<tr>
			<td colspan="2"><a class='fancy_button' href="./RSET Thruster_Test std_msgs/Bool true" >Test Thrusters</a></td><td colspan="2"></td>
			<td colspan="8"></td>
		</tr>
		<tr>
			<td colspan="8">
				<font color=red><p id="pup_leak">LEAK1</p></font>
				<font color=red><p id="plw_leak">LEAK2</p></font>
			</td>
			<td colspan="2"><a class='fancy_button' href="./RSET bat_monit/pc_shutdown std_msgs/Bool true" >Shutdown PC</a></td>
			<td colspan="2"></td>
		</tr>
	</table>
	</center>
</body>
</html>
